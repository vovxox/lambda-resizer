<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Simple Image Resizer</title>
        <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
        <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
        <script src="https://unpkg.com/babel-standalone@6.26.0/babel.js"></script>
        <script src="https://unpkg.com/react/umd/react.production.min.js" crossorigin></script>
        <script src="https://unpkg.com/react-dom/umd/react-dom.production.min.js" crossorigin></script>
        <script src="https://unpkg.com/react-bootstrap@next/dist/react-bootstrap.min.js" crossorigin></script>
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"/>
        <link rel="stylesheet" href="./index.css"/>
    </head>

    <body>
    <div id="root"></div>
    <script type="text/babel">
        //====================
        // DEBUG
        //====================
        var DEBUG_MODE = true;

        //====================
        // Common variables
        //====================
        var bucketName = "resizer-lambda-bucket-hoon"
        var serverUrl = "https://acoszpmj60.execute-api.ap-southeast-2.amazonaws.com/dev";
        var downloadUrl = "./test.png";
        var imgUrl = "./test.png";

        //var Button = ReactBootstrap.Button;

        //====================
        // First Page Class
        //====================
        class FirstPage extends React.Component {
            constructor(props) {
                super(props);
                
                //====================
                // State
                //====================
                this.state = {
                    fileName: ''
                };

                //====================
                // References
                //====================
                this.fileInput = React.createRef();
                this.fileNameInput = React.createRef();

                //====================
                // Functions
                //====================
                this.selectFileClick = this.selectFileClick.bind(this);
                this.fileChange = this.fileChange.bind(this);
                this.uploadClick = this.uploadClick.bind(this);
            }

            componentDidMount() {
                //Hide babel script errors
                console.clear();
            }

            selectFileClick = () => {
                this.fileInput.current.click();
            }
            
            fileChange = (fileList) => {                
                this.setState({fileName: fileList[0].name});
            }

            uploadClick = () => {
                if (DEBUG_MODE) {
                    ReactDOM.render(<SecondPage />, document.getElementById('root'))
                }
                else {
                    axios({
                        method: 'post',
                        url: serverUrl,
                        responseType: 'json',
                        responseEncoding: 'utf8',
                        data: {
                            BucketName: bucketName,
                            methodType: "POST",
                            FileName: this.state.fileName
                        }
                    })
                    .then(function (response) {
                        console.log(response)
                    });
                }
            }

            dropHandler = (e) => {
                // Prevent default behavior (Prevent file from being opened)
                e.preventDefault();

                if (e.dataTransfer.items) {
                    if (e.dataTransfer.items[0].kind === 'file') {
                        var file = e.dataTransfer.items[0].getAsFile();
                        var fileName = file.name;
                        this.state.fileName = fileName;
                    }
                } else {
                    // Use DataTransfer interface to access the file(s)
                    for (var i = 0; i < e.dataTransfer.files.length; i++) {
                        console.log('... file[' + i + '].name = ' + e.dataTransfer.files[i].name);
                    }
                }
            }
            
            dragOverHandler = (e) => {
                // Prevent default behavior (Prevent file from being opened)
                e.preventDefault();
            }

            render() {
                return (
                    <div>
                        <h1 align="center">Simple Picture Resizer (Step1)</h1>
                        <div class="div-first-page">
                            <div class="bg-primary" id="drop_zone" ondrop={ (e) => this.dropHandler(e) } ondragover={ (e) => this.dragOverHandler(e) }>
                                <p id="fileNameAreaId">Drag a image file here</p>
                                <button class="btn btn-light" id="fileSelectBtnId" onClick={this.selectFileClick}>Select File</button>
                            </div>
                            <button class="btn btn-success" id="ObjectUploadBtnId" onClick={this.uploadClick}>Upload File</button>
                        </div>
                        <div id="hidden_zone" style={{display: DEBUG_MODE ? 'block' : 'none' }}>
                            <div id="hidden_zone">
                                <form enctype="multipart/form-data" method="POST" name="formS3ObjManager" id="formS3ObjManagerId">
                                    <input accept="image/*" type="file" className="hide" ref={this.fileInput} onChange={ (e) => this.fileChange(e.target.files) } required />
                                </form>
                                <input type="text" id="bucketNameId" name="BucketName" value={bucketName}/>
                                <input type="text" id="methodTypeId" name="MethodType" value="POST"/>
                                <input type="text" id="fileNameId" name="FileNameId" value={this.state.fileName} ref={this.fileNameInput} />
                            </div>
                        </div>
                    </div>
                );
            }
        }

        //====================
        // Second Page Class
        //====================
        class SecondPage extends React.Component {
            constructor(props) {
                super(props);
                
                //====================
                // State
                //====================
                this.state = {
                    sizeOption: "size25",
                    customOption: "percent",
                    resizeWidth: "",
                    resizeHeight: "",
                };

                //====================
                // References
                //====================
                
                //====================
                // Functions
                //====================
                this.sizeOptionClick = this.sizeOptionClick.bind(this);
                this.customOptionClick = this.customOptionClick.bind(this);
                this.downloadClick = this.downloadClick.bind(this);
            }

            componentDidMount() {
                //Hide babel script errors
                console.clear();
            }

            sizeOptionClick = (e) => {
                this.setState({sizeOption: e.target.id});
            }

            customOptionClick = (e) => {
                this.setState({customOption: e.target.id});
            }

            downloadClick = () => {
                if (DEBUG_MODE) {
                    window.open(downloadUrl);
                }
                else {
                    axios({
                        method: 'get',
                        url: serverUrl,
                        responseType: 'json',
                        responseEncoding: 'utf8',
                        data: this.states
                    })
                    .then(function (response) {
                        console.log(response)
                    });
                }
            }

            render() {
                return (
                    <div>
                        <h1 align="center">Simple Picture Resizer (Step2)</h1>
                        <div class="div-second-page">
                            <div class="div-image-area">
                                <img class="img-target" src={imgUrl} />
                            </div>

                            <div class="div-options" id="optionsAreaId">
                                <div class="btn-group btn-group-toggle">
                                    <label class={this.state.sizeOption == "size25" ? 'btn btn-info active' : 'btn btn-info' }>
                                        <radio name="sizeOptions" id="size25" autocomplete="off" onClick={ (e) => this.sizeOptionClick(e) }>25%</radio>
                                    </label>
                                    <label class={this.state.sizeOption == "size50" ? 'btn btn-info active' : 'btn btn-info' }>
                                        <radio name="sizeOptions" id="size50" autocomplete="off" onClick={ (e) => this.sizeOptionClick(e) }>50%</radio>
                                    </label>
                                    <label class={this.state.sizeOption == "size75" ? 'btn btn-info active' : 'btn btn-info' }>
                                        <radio name="sizeOptions" id="size75" autocomplete="off" onClick={ (e) => this.sizeOptionClick(e) }>75%</radio>
                                    </label>
                                    <label class={this.state.sizeOption == "custom" ? 'btn btn-info active' : 'btn btn-info' }>
                                        <radio name="sizeOptions" id="custom" autocomplete="off" onClick={ (e) => this.sizeOptionClick(e) }>Custom</radio>
                                    </label>
                                </div>
                            </div>

                            <div class="div-options" style={{display: this.state.sizeOption == "custom" ? 'block' : 'none' }}>
                                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">Custom Options</span>
                                    </div>
                                    <label class={this.state.customOption == "percent" ? 'btn btn-info active' : 'btn btn-info' }>
                                        <radio name="customOptions" id="percent" autocomplete="off" onClick={ (e) => this.customOptionClick(e) }>Percent</radio>
                                    </label>
                                    <label class={this.state.customOption == "pixel" ? 'btn btn-info active' : 'btn btn-info' }>
                                        <radio name="customOptions" id="pixel" autocomplete="off" onClick={ (e) => this.customOptionClick(e) }>Pixel</radio>
                                    </label>
                                </div>
                            </div>

                            <div class="div-options" style={{display: this.state.sizeOption == "custom" ? 'block' : 'none' }}>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">Custom Size</span>
                                    </div>
                                    <input type="text" class="form-control" placeholder="Width" value={this.state.resizeWidth} onChange={event => this.setState({resizeWidth: event.target.value.replace(/\D/,'')})}/>
                                    <input type="text" class="form-control" placeholder="Height" value={this.state.resizeHeight} onChange={event => this.setState({resizeHeight: event.target.value.replace(/\D/,'')})}/>
                                </div>
                            </div>

                            <div class="div-download" id="downloadButtonAreaId">
                                <button class="btn btn-success" id="downloadBtnId" onClick={this.downloadClick}>Download File</button>
                            </div>
                        </div>
                    </div>
                );
            }
        }

        ReactDOM.render(<FirstPage />, document.getElementById('root'))
    </script>
    </body>
</html>